# –ñ—É—Ä–Ω–∞–ª —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ The Space

## 2025-10-28 - –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–æ–µ–∫—Ç–∞
- –ù–∞—Å—Ç—Ä–æ–µ–Ω–∞ –±–∞–∑–æ–≤–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞
- –°–æ–∑–¥–∞–Ω–∞ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –ø–æ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–µ

---

## –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ UI –ø—Ä–æ–±–ª–µ–º —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–∞

### –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ
- –°–∏—Å—Ç–µ–º–∞ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ –∏ CORS
- –ë–∞–∑–æ–≤–∞—è —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å —á–∞—Ç–∞
- –ú–æ–¥–∞–ª—å–Ω—ã–µ –æ–∫–Ω–∞
- –ì—Ä–∞–¥–∏–µ–Ω—Ç–Ω—ã–µ –∏–∫–æ–Ω–∫–∏ –¥–ª—è —á–∞—Ç–æ–≤
- –ê–≤–∞—Ç–∞—Ä—ã –≤ —Å–æ–æ–±—â–µ–Ω–∏—è—Ö
- –¶–≤–µ—Ç–æ–≤–∞—è —Å—Ö–µ–º–∞ (—Ç–µ–º–Ω–æ-–∫—Ä–∞—Å–Ω—ã–π #8B0000)

### –ò—Å–ø—Ä–∞–≤–ª–µ–Ω—ã –ø—É—Ç–∏ –∫ SVG –∏–∫–æ–Ω–∫–∞–º
- –ü—Ä–æ–±–ª–µ–º–∞: —Ñ–∞–π–ª—ã –Ω–∞—Ö–æ–¥–∏–ª–∏—Å—å –≤ `assets/icons/`, –∞ –ø—É—Ç–∏ —É–∫–∞–∑—ã–≤–∞–ª–∏ –Ω–∞ `assets/`
- –ò—Å–ø—Ä–∞–≤–ª–µ–Ω—ã –ø—É—Ç–∏ –≤–æ –≤—Å–µ—Ö —Ñ–∞–π–ª–∞—Ö –Ω–∞ `assets/icons/`
- –§–∞–π–ª—ã: `MIN/chat.html`, `MIN/js/chat.js`

### –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —Å–æ–∑–¥–∞–Ω–∏—è –∫–æ–º–Ω–∞—Ç—ã
- –ü—Ä–æ–±–ª–µ–º–∞: –∫–Ω–æ–ø–∫–∞ "–°–æ–∑–¥–∞—Ç—å" –Ω–µ —Ä–∞–±–æ—Ç–∞–ª–∞
- –†–µ—à–µ–Ω–∏–µ: –ø–µ—Ä–µ—Ä–∞–±–æ—Ç–∞–Ω –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ —Å–æ–±—ã—Ç–∏–π –≤ `MIN/js/modal.js` - –≤—Å—è –ª–æ–≥–∏–∫–∞ –ø–µ—Ä–µ–Ω–µ—Å–µ–Ω–∞ –≤ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–ª–∏–∫–∞ –∫–Ω–æ–ø–∫–∏

### –ö–Ω–æ–ø–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏
- –ó–∞–º–µ–Ω–µ–Ω–∞ —Ç–µ–∫—Å—Ç–æ–≤–∞—è –∫–Ω–æ–ø–∫–∞ –Ω–∞ SVG –∏–∫–æ–Ω–∫—É `sendbutt.svg`
- –ò–∑–º–µ–Ω–µ–Ω —Ü–≤–µ—Ç –≥—Ä–∞–¥–∏–µ–Ω—Ç–∞ —Å —Ñ–∏–æ–ª–µ—Ç–æ–≤–æ–≥–æ –Ω–∞ —Ç–µ–º–Ω–æ-–∫—Ä–∞—Å–Ω—ã–π
- –£–≤–µ–ª–∏—á–µ–Ω–∞ –¥–æ 72x72px (–±—ã–ª–æ 48x48px)
- –§–∞–π–ª—ã: `MIN/css/stylechat.css`, `MIN/js/chat.js`

### –ò–∫–æ–Ω–∫–∞ –∫–æ—Ç–∞
- –£–≤–µ–ª–∏—á–µ–Ω–∞ –¥–æ 300x300px (–±—ã–ª–æ 200x200px)

---

## 2025-11-06 - –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ —É–¥–∞–ª–µ–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏–π

### API –º–µ—Ç–æ–¥—ã
- –î–æ–±–∞–≤–ª–µ–Ω—ã `updateMessage()` –∏ `deleteMessage()` –≤ `MIN/js/api.js`

### UI
- –ö–Ω–æ–ø–∫–∏ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è/—É–¥–∞–ª–µ–Ω–∏—è –¥–ª—è —Å–æ–±—Å—Ç–≤–µ–Ω–Ω—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π (–≤–∏–¥–Ω—ã –ø—Ä–∏ hover)
- Inline —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π Enter/Escape
- –ú–æ–¥–∞–ª—å–Ω–æ–µ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏

### Socket.IO –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏
- –°–æ–±—ã—Ç–∏—è `message_edited` –∏ `message_deleted` –¥–ª—è real-time —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏
- –ö–ª–∏–µ–Ω—Ç—Å–∫–∞—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ `user_id` –¥–ª—è –∏–∑–±–µ–∂–∞–Ω–∏—è –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è
- –†–µ—à–µ–Ω–∞ –ø—Ä–æ–±–ª–µ–º–∞ —Å `skip_sid` - —É–±—Ä–∞–Ω –ø–∞—Ä–∞–º–µ—Ç—Ä, —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ –∫–ª–∏–µ–Ω—Ç—Å–∫–∞—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è

### –ò–∑–º–µ–Ω–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã
`MIN/js/api.js`, `MIN/js/chat.js`, `MIN/css/stylechat.css`, `utils/socketio_handlers.py`

---

## 2025-11-10 - –ü—Ä–æ—Ñ–∏–ª–∏ –∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–æ–º–Ω–∞—Ç–∞–º–∏

### –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –ø—Ä–æ—Ñ–∏–ª—è
- –°—Ç—Ä—É–∫—Ç—É—Ä–∞: –±–∞–Ω–Ω–µ—Ä (200px), –∞–≤–∞—Ç–∞—Ä (120x120px), –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è (nickname, email, ID)
- –ì—Ä–∞–¥–∏–µ–Ω—Ç–Ω—ã–µ –±–∞–Ω–Ω–µ—Ä—ã –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é (–≥–µ–Ω–µ—Ä–∞—Ü–∏—è –Ω–∞ –æ—Å–Ω–æ–≤–µ ID)
- –û—Ç–∫—Ä—ã—Ç–∏–µ —Å–≤–æ–µ–≥–æ –∏ —á—É–∂–∏—Ö –ø—Ä–æ—Ñ–∏–ª–µ–π (–∫–ª–∏–∫ –ø–æ –∞–≤–∞—Ç–∞—Ä–∞–º –≤ —Å–æ–æ–±—â–µ–Ω–∏—è—Ö)

### –°–æ–∑–¥–∞–Ω–∏–µ –∫–æ–º–Ω–∞—Ç —Å —É—á–∞—Å—Ç–Ω–∏–∫–∞–º–∏
- API —ç–Ω–¥–ø–æ–∏–Ω—Ç `/auth/check-user` –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- –≠–Ω–¥–ø–æ–∏–Ω—Ç `POST /{space_id}/add-user` –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤
- –ß–∏–ø—ã —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤ –≤ —Ñ–æ—Ä–º–µ —Å–æ–∑–¥–∞–Ω–∏—è
- –í–∞–ª–∏–¥–∞—Ü–∏—è –¥—É–±–ª–∏–∫–∞—Ç–æ–≤
- –§–∞–π–ª—ã: `MIN/js/modal.js`, `routers/auth.py`, `routers/spaces.py`

### –ü—Ä–∞–≤–∞—è –ø–∞–Ω–µ–ª—å –∫–æ–º–Ω–∞—Ç—ã
- –°–ø–∏—Å–æ–∫ —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤ —Å –∞–≤–∞—Ç–∞—Ä–∞–º–∏
- –°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ (–∞–¥–º–∏–Ω –ø–µ—Ä–≤—ã–π)
- –†–æ–ª—å —É—á–∞—Å—Ç–Ω–∏–∫–∞ (–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä/–£—á–∞—Å—Ç–Ω–∏–∫)
- –ö–ª–∏–∫ –ø–æ —É—á–∞—Å—Ç–Ω–∏–∫—É –¥–ª—è –æ—Ç–∫—Ä—ã—Ç–∏—è –ø—Ä–æ—Ñ–∏–ª—è

### –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–æ–º–Ω–∞—Ç–æ–π
–≠–Ω–¥–ø–æ–∏–Ω—Ç—ã:
- `PATCH /{space_id}/name` - –∏–∑–º–µ–Ω–µ–Ω–∏–µ –Ω–∞–∑–≤–∞–Ω–∏—è (—Ç–æ–ª—å–∫–æ –∞–¥–º–∏–Ω)
- `POST /{space_id}/leave` - –≤—ã—Ö–æ–¥ –∏–∑ –∫–æ–º–Ω–∞—Ç—ã (–∑–∞–ø—Ä–µ—â–µ–Ω–æ –∞–¥–º–∏–Ω—É)
- `DELETE /{space_id}/delete` - —É–¥–∞–ª–µ–Ω–∏–µ –∫–æ–º–Ω–∞—Ç—ã —Å –∫–∞—Å–∫–∞–¥–Ω—ã–º —É–¥–∞–ª–µ–Ω–∏–µ–º –¥–∞–Ω–Ω—ã—Ö (—Ç–æ–ª—å–∫–æ –∞–¥–º–∏–Ω)

### –ì—Ä–∞–¥–∏–µ–Ω—Ç–Ω—ã–µ –∞–≤–∞—Ç–∞—Ä—ã
```javascript
function generateGradientFromId(id) {
    const hash = id * 2654435761 % 2**32;
    const hue1 = (hash % 360);
    const hue2 = (hue1 + 60) % 360;
    return `linear-gradient(135deg, hsl(${hue1}, 70%, 60%) 0%, hsl(${hue2}, 70%, 50%) 100%)`;
}
```

### –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è
- –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –Ω–∏–∫–Ω–µ–π–º–æ–≤ –≤ —Å–æ–æ–±—â–µ–Ω–∏—è—Ö (–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ `msg.user_nickname` –≤–º–µ—Å—Ç–æ `state.currentUser.nickname`)
- –û—á–∏—Å—Ç–∫–∞ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ (—É–¥–∞–ª–µ–Ω—ã –≤—Ä–µ–º–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã, –≤—Å–µ –≤ `CLAUDE.md`)

---

## 2025-11-12 - –°–∏—Å—Ç–µ–º–∞ –∞–≤–∞—Ç–∞—Ä–æ–≤ –∏ –±–∞–Ω–Ω–µ—Ä–æ–≤

### –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è Supabase Storage
–ú–æ–¥—É–ª—å: `utils/storage.py`

**–û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π:**
- –ê–≤–∞—Ç–∞—Ä—ã: 400x400px, –∫–∞—á–µ—Å—Ç–≤–æ 85%
- –ë–∞–Ω–Ω–µ—Ä—ã: 1200x400px, –∫–∞—á–µ—Å—Ç–≤–æ 90%
- –ê–≤—Ç–æ–∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è –≤ RGB –¥–ª—è JPEG

**–ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∏–º–µ–Ω:**
```python
{user_id}/{file_type}_{timestamp}_{hash}.jpg
```

**–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª:**
- –ó–∞–≥—Ä—É–∑–∫–∞ –≤ bucket —Å `upsert: true`
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —É–¥–∞–ª–µ–Ω–∏–µ —Å—Ç–∞—Ä—ã—Ö —Ñ–∞–π–ª–æ–≤ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –Ω–æ–≤—ã—Ö
- –î–µ—Ç–∞–ª—å–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

### API —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã
- `POST /profile/upload-avatar` - –º–∞–∫—Å 5MB (JPEG, PNG, WebP)
- `POST /profile/upload-banner` - –º–∞–∫—Å 10MB

### –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ö–µ–º
–î–æ–±–∞–≤–ª–µ–Ω—ã –ø–æ–ª—è –≤ `UserOut`:
```python
avatar_url: Optional[str] = None
profile_background_url: Optional[str] = None
```

### UI –∑–∞–≥—Ä—É–∑–∫–∏
- Overlay –ø—Ä–∏ –Ω–∞–≤–µ–¥–µ–Ω–∏–∏ –Ω–∞ –∞–≤–∞—Ç–∞—Ä –≤–º–µ—Å—Ç–æ –æ—Ç–¥–µ–ª—å–Ω–æ–π –∫–Ω–æ–ø–∫–∏
- –†–µ—à–µ–Ω–∞ –ø—Ä–æ–±–ª–µ–º–∞ –∫–≤–∞–¥—Ä–∞—Ç–Ω–æ–≥–æ overlay - –¥–æ–±–∞–≤–ª–µ–Ω `border-radius: 50%`
- –ö–Ω–æ–ø–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –±–∞–Ω–Ω–µ—Ä–∞ - –∏–∫–æ–Ω–∫–∞ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –≤ —É–≥–ª—É

### WebSocket –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è
- –î–æ–±–∞–≤–ª–µ–Ω–æ –ø–æ–ª–µ `user_avatar_url` –≤ –ø–µ—Ä–µ–¥–∞–≤–∞–µ–º—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è
- –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∞–≤–∞—Ç–∞—Ä–æ–≤ –≤: –∏—Å—Ç–æ—Ä–∏–∏ —Å–æ–æ–±—â–µ–Ω–∏–π, –Ω–æ–≤—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏—è—Ö (WebSocket), —Å–ø–∏—Å–∫–µ —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤, –ª–µ–≤–æ–π –ø–∞–Ω–µ–ª–∏

### –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è
- –î–∞–Ω–Ω—ã–µ –Ω–µ —Å–æ—Ö—Ä–∞–Ω—è–ª–∏—Å—å: –¥–æ–±–∞–≤–ª–µ–Ω—ã –ø–æ–ª—è –≤ `UserOut` –¥–ª—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–≥–æ –≤–æ–∑–≤—Ä–∞—Ç–∞ –∏–∑ `/auth/me`
- –ê–≤–∞—Ç–∞—Ä—ã –Ω–µ –≤ —á–∞—Ç–∞—Ö: –ø–µ—Ä–µ–¥–∞—á–∞ `user_avatar_url` —á–µ—Ä–µ–∑ WebSocket

### –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
```env
SUPABASE_URL="https://project.supabase.co"
SUPABASE_KEY="your-service-role-key"
SUPABASE_BUCKET="avatars"
```

–ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏: `supabase>=2.0.0`, `Pillow>=10.0.0`

---

## 2025-11-26 - –§–∞–π–ª—ã –∏ —Ä–µ–∞–∫—Ü–∏–∏ –Ω–∞ —Å–æ–æ–±—â–µ–Ω–∏—è

### –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è Cloudinary
–ú–æ–¥—É–ª—å: `utils/file_upload.py`

**–¢–∏–ø—ã —Ñ–∞–π–ª–æ–≤:**
- –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è: JPEG, PNG, GIF, WebP (–º–∞–∫—Å 10MB)
- –ê—É–¥–∏–æ: MP3, WAV, OGG, M4A (–º–∞–∫—Å 50MB)
- –î–æ–∫—É–º–µ–Ω—Ç—ã: PDF, DOC, DOCX, TXT (–º–∞–∫—Å 20MB)

### –ú–æ–¥–µ–ª–∏ –¥–∞–Ω–Ω—ã—Ö
```python
class Attachment(Base):
    message_id, file_url, file_type, file_size

class Reaction(Base):
    message_id, user_id, reaction  # —ç–º–æ–¥–∑–∏
```

–°–≤—è–∑—å: `Message.attachment` —Å `lazy="joined"` –¥–ª—è eager loading

### CRUD –æ–ø–µ—Ä–∞—Ü–∏–∏
**–û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è:**
```python
messages = self.db.query(Message).options(
    joinedload(Message.attachment)
).join(User).filter(...)
```

**Toggle –ª–æ–≥–∏–∫–∞ —Ä–µ–∞–∫—Ü–∏–π:**
- –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–π —Ä–µ–∞–∫—Ü–∏–∏
- –£–¥–∞–ª–µ–Ω–∏–µ –ø—Ä–∏ –ø–æ–≤—Ç–æ—Ä–Ω–æ–º –∫–ª–∏–∫–µ (toggle off)
- –ó–∞–º–µ–Ω–∞ —ç–º–æ–¥–∑–∏ –µ—Å–ª–∏ –¥—Ä—É–≥–∞—è —Ä–µ–∞–∫—Ü–∏—è
- –ì—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞ —Å –ø–æ–¥—Å—á–µ—Ç–æ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

### API —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã
- `POST /{chat_id}/upload-image` - –∑–∞–≥—Ä—É–∑–∫–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
- `POST /{chat_id}/upload-audio` - –∑–∞–≥—Ä—É–∑–∫–∞ –∞—É–¥–∏–æ
- `POST /{chat_id}/upload-document` - –∑–∞–≥—Ä—É–∑–∫–∞ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤
- `POST /{chat_id}/{message_id}/react` - toggle —Ä–µ–∞–∫—Ü–∏–∏ —Å WebSocket broadcast
- `GET /{chat_id}/{message_id}/reactions` - —Å–ø–∏—Å–æ–∫ —Ä–µ–∞–∫—Ü–∏–π

### WebSocket
–ì–ª–æ–±–∞–ª—å–Ω—ã–π –∏–Ω—Å—Ç–∞–Ω—Å Socket.IO: `utils/socketio_instance.py`
```python
_sio_instance = None
def set_sio(sio): ...
def get_sio(): ...
```

–ü–µ—Ä–µ–¥–∞—á–∞ –≤–ª–æ–∂–µ–Ω–∏–π:
```python
attachment_data = {
    'id': new_message.attachment.id,
    'file_url': new_message.attachment.file_url,
    'file_type': new_message.attachment.file_type,
    'file_size': new_message.attachment.file_size
}
```

### Frontend
**–ú–æ–¥—É–ª–∏:**
- `MIN/css/attachments.css` - —Å—Ç–∏–ª–∏ –≤–ª–æ–∂–µ–Ω–∏–π –∏ —Ä–µ–∞–∫—Ü–∏–π
- `MIN/js/attachments.js` - —É—Ç–∏–ª–∏—Ç—ã (–≤–∞–ª–∏–¥–∞—Ü–∏—è, —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥, lightbox)

**–ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã:**
- Lightbox –¥–ª—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π (–ø–æ–ª–Ω–æ—ç–∫—Ä–∞–Ω–Ω—ã–π –ø—Ä–æ—Å–º–æ—Ç—Ä)
- –ö–∞—Å—Ç–æ–º–Ω—ã–π –ø–ª–µ–µ—Ä –¥–ª—è –∞—É–¥–∏–æ
- –ü—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ —Å –∏–∫–æ–Ω–∫–æ–π –∏ —Ä–∞–∑–º–µ—Ä–æ–º
- Reaction picker (42 —ç–º–æ–¥–∑–∏, 6√ó7 grid)

**–õ–æ–≥–∏–∫–∞:**
- –§–ª–∞–≥ `fileAttachmentInitialized` –¥–ª—è –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏—è –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤
- –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–∞–π–ª–∞
- –£–º–Ω–æ–µ –ø–æ–∑–∏—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ reaction picker (—Ä–∞—Å—á–µ—Ç –¥–æ—Å—Ç—É–ø–Ω–æ–≥–æ –º–µ—Å—Ç–∞)
- –ü–æ–¥—Å–≤–µ—Ç–∫–∞ —Å–≤–æ–µ–π —Ä–µ–∞–∫—Ü–∏–∏ —á–µ—Ä–µ–∑ –∫–ª–∞—Å—Å `.my-reaction`

### –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã
1. –î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ —Ñ–∞–π–ª–æ–≤ - —Ñ–ª–∞–≥ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ + –∫–ª–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ input
2. –§–∞–π–ª—ã –Ω–µ –æ—Ç–æ–±—Ä–∞–∂–∞–ª–∏—Å—å –ø–æ—Å–ª–µ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∏ - –¥–æ–±–∞–≤–ª–µ–Ω `joinedload`
3. Lightbox –Ω–µ —Ä–∞–±–æ—Ç–∞–ª –¥–ª—è –Ω–æ–≤—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π - –≤—ã–∑–æ–≤ `attachReactionHandlers()` –ø–æ—Å–ª–µ –∫–∞–∂–¥–æ–≥–æ –Ω–æ–≤–æ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è
4. –†–µ–∞–∫—Ü–∏–∏ —Å –ø—Ä–æ–∑—Ä–∞—á–Ω—ã–º —Ñ–æ–Ω–æ–º - –∏–∑–º–µ–Ω–µ–Ω–∏–µ –Ω–∞ `#2c2f33`
5. Popup –≤—ã–ª–µ–∑–∞–ª –∑–∞ —ç–∫—Ä–∞–Ω - –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ `top` –≤–º–µ—Å—Ç–æ `bottom`
6. –î–æ–∫—É–º–µ–Ω—Ç—ã —Å –±–µ–ª—ã–º —Ç–µ–∫—Å—Ç–æ–º - –¥–æ–±–∞–≤–ª–µ–Ω —Ñ–æ–Ω `#2c2f33`
7. –ü–æ—Ä—Ç 8000 –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω - –ø–µ—Ä–µ—Ö–æ–¥ –Ω–∞ 8080

### –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
```env
CLOUDINARY_CLOUD_NAME="your-cloud-name"
CLOUDINARY_API_KEY="your-api-key"
CLOUDINARY_API_SECRET="your-api-secret"
```

---

## 2025-12-03 - –°–∏—Å—Ç–µ–º–∞ —Ä–æ–ª–µ–π —Å –∏–µ—Ä–∞—Ä—Ö–∏–µ–π

### –ò–µ—Ä–∞—Ä—Ö–∏—è —Ä–æ–ª–µ–π
–ú–æ–¥—É–ª—å: `models/permissions.py`

```python
class RoleHierarchy:
    LEVELS = {
        "–£—á–∞—Å—Ç–Ω–∏–∫": 1,
        "–ú–æ–¥–µ—Ä–∞—Ç–æ—Ä": 2,
        "–í–ª–∞–¥–µ–ª–µ—Ü": 3
    }

    @staticmethod
    def can_moderate(moderator_role, target_role):
        return get_level(moderator_role) > get_level(target_role)
```

**–ü—Ä–∞–≤–∏–ª–∞:**
- –í–ª–∞–¥–µ–ª–µ—Ü —É–ø—Ä–∞–≤–ª—è–µ—Ç –≤—Å–µ–º–∏
- –ú–æ–¥–µ—Ä–∞—Ç–æ—Ä —É–ø—Ä–∞–≤–ª—è–µ—Ç —Ç–æ–ª—å–∫–æ —É—á–∞—Å—Ç–Ω–∏–∫–∞–º–∏
- –ú–æ–¥–µ—Ä–∞—Ç–æ—Ä –ù–ï –º–æ–∂–µ—Ç –∫–∏–∫–∞—Ç—å/–±–∞–Ω–∏—Ç—å –¥—Ä—É–≥–∏—Ö –º–æ–¥–µ—Ä–∞—Ç–æ—Ä–æ–≤ –∏ –≤–ª–∞–¥–µ–ª—å—Ü–∞

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∞–≤ –≤ backend
–î–æ–±–∞–≤–ª–µ–Ω—ã –ø—Ä–æ–≤–µ—Ä–∫–∏ –∏–µ—Ä–∞—Ä—Ö–∏–∏ –≤–æ –≤—Å–µ –º–æ–¥–µ—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ –¥–µ–π—Å—Ç–≤–∏—è:
- `DELETE /{space_id}/kick/{user_id}`
- `POST /{space_id}/ban/{user_id}`
- `PATCH /{space_id}/roles/{user_id}`

```python
if not RoleHierarchy.can_moderate(moderator_role.name, target_role.name):
    raise HTTPException(status_code=403, detail="–í—ã –Ω–µ –º–æ–∂–µ—Ç–µ —É–ø—Ä–∞–≤–ª—è—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º —Å —ç—Ç–æ–π —Ä–æ–ª—å—é")
```

### –ü–µ—Ä–µ—Ä–∞–±–æ—Ç–∫–∞ —Å–∏—Å—Ç–µ–º—ã –±–∞–Ω–æ–≤
**–ö–æ–Ω—Ü–µ–ø—Ü–∏—è:**
- –ó–∞–±–∞–Ω–µ–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –æ—Å—Ç–∞—é—Ç—Å—è –≤ —á–∞—Ç–µ
- –ú–æ–≥—É—Ç —á–∏—Ç–∞—Ç—å, –Ω–æ –Ω–µ –º–æ–≥—É—Ç –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–æ–≤–∞—Ç—å (—Å–æ–æ–±—â–µ–Ω–∏—è, —Ä–µ–∞–∫—Ü–∏–∏, —Ñ–∞–π–ª—ã)

**–ò–∑–º–µ–Ω–µ–Ω–∏—è:**
- –£–¥–∞–ª–µ–Ω –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –∫–∏–∫ –ø—Ä–∏ –±–∞–Ω–µ
- –î–æ–±–∞–≤–ª–µ–Ω–æ –ø–æ–ª–µ `is_banned` –≤ API `/spaces/{space_id}/participants`
- –ü—Ä–æ–≤–µ—Ä–∫–∏ –±–∞–Ω–∞ –≤: WebSocket `send_message`, REST `/react`, `/upload-*`

**–†–∞–∑–±–∞–Ω:**
```python
# crud/ban.py
def remove(self, user_id, space_id):
    # –£–¥–∞–ª–µ–Ω–∏–µ –≤—Å–µ—Ö –∞–∫—Ç–∏–≤–Ω—ã—Ö –±–∞–Ω–æ–≤
```

–≠–Ω–¥–ø–æ–∏–Ω—Ç: `DELETE /{space_id}/unban/{user_id}`

### Frontend
**–ò–∫–æ–Ω–∫–∞ –±–∞–Ω–∞:**
- –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ üö´ –≤–æ –≤—Å–µ—Ö —Å–ø–∏—Å–∫–∞—Ö —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤
- `title="–ó–∞–±–∞–Ω–µ–Ω"` –¥–ª—è –ø–æ–¥—Å–∫–∞–∑–∫–∏

**–ö–æ–Ω—Ç–µ–∫—Å—Ç–Ω–æ–µ –º–µ–Ω—é:**
- –ü—Ä–æ–≤–µ—Ä–∫–∞ –∏–µ—Ä–∞—Ä—Ö–∏–∏ –Ω–∞ –∫–ª–∏–µ–Ω—Ç–µ
- –î–∏–Ω–∞–º–∏—á–µ—Å–∫–æ–µ –º–µ–Ω—é: "–†–∞–∑–±–∞–Ω–∏—Ç—å" –¥–ª—è –∑–∞–±–∞–Ω–µ–Ω–Ω—ã—Ö, "–ö–∏–∫–Ω—É—Ç—å"/"–ó–∞–±–∞–Ω–∏—Ç—å" –¥–ª—è –∞–∫—Ç–∏–≤–Ω—ã—Ö
- –°–∫—Ä—ã—Ç–∏–µ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω—ã—Ö –æ–ø—Ü–∏–π –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Ä–æ–ª–∏

**–£—Ç–∏–ª–∏—Ç–∞:**
```javascript
function canUserModerate(moderatorRole, targetRole) {
    const hierarchy = { '–í–ª–∞–¥–µ–ª–µ—Ü': 3, '–ú–æ–¥–µ—Ä–∞—Ç–æ—Ä': 2, '–£—á–∞—Å—Ç–Ω–∏–∫': 1 };
    return hierarchy[moderatorRole] > hierarchy[targetRole];
}
```

### –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è —Ä–æ–ª–µ–π
- –ü—Ä–æ–±–ª–µ–º–∞: —Ä–æ–ª–∏ —Å–æ–∑–¥–∞–≤–∞–ª–∏—Å—å –≤ `crud/space.py` –∏ `routers/spaces.py`
- –†–µ—à–µ–Ω–∏–µ: —Ä–æ–ª–∏ —Å–æ–∑–¥–∞—é—Ç—Å—è —Ç–æ–ª—å–∫–æ –≤ —ç–Ω–¥–ø–æ–∏–Ω—Ç–µ —Å–æ–∑–¥–∞–Ω–∏—è –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–∞
- –û—á–∏—Å—Ç–∫–∞ –¥—É–±–ª–µ–π: —Å–∫—Ä–∏–ø—Ç `cleanup_duplicate_roles.py`

### –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–æ–Ω—Ç–µ–∫—Å—Ç–Ω–æ–≥–æ –º–µ–Ω—é
- –î–æ–±–∞–≤–ª–µ–Ω `contextMenu.classList.remove('active')` –≤ –Ω–∞—á–∞–ª–µ –∫–∞–∂–¥–æ–π —Ñ—É–Ω–∫—Ü–∏–∏ –º–æ–¥–µ—Ä–∞—Ü–∏–∏

### Git workflow
- –°–ª–∏—è–Ω–∏–µ —Å –∫–æ–º–º–∏—Ç–æ–º backend-—Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∞ (@-—Ç–µ–≥–∏, —Å—Ç–∏–∫–µ—Ä—ã, –≤–∞–ª–∏–¥–∞—Ü–∏—è)
- Rebase —Å `origin/main`
- –†–∞–∑—Ä–µ—à–µ–Ω—ã –∫–æ–Ω—Ñ–ª–∏–∫—Ç—ã –≤ `schemas/user.py` –∏ `schemas/space.py`
- –û—Å—Ç–∞–≤–ª–µ–Ω–∞ –≤–µ—Ä—Å–∏—è —Å `utils.validators.Validators`

---

## 2025-12-11 - @-—É–ø–æ–º–∏–Ω–∞–Ω–∏—è –∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è

### –ú–æ–¥–µ–ª–∏ –¥–∞–Ω–Ω—ã—Ö
```python
class Notification(Base):
    user_id, type, title, content
    related_message_id, related_user_id, related_space_id
    is_read, created_at

class Mention(Base):
    message_id, mentioned_user_id
    __table_args__ = (Index('ix_mentions_message_user'),)  # –£–Ω–∏–∫–∞–ª—å–Ω–æ—Å—Ç—å
```

### CRUD –æ–ø–µ—Ä–∞—Ü–∏–∏
**–ü–∞—Ä—Å–∏–Ω–≥ —É–ø–æ–º–∏–Ω–∞–Ω–∏–π:**
```python
pattern = r'@([^\s@]+)'  # –ü–æ–¥–¥–µ—Ä–∂–∫–∞ —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã—Ö —Å–∏–º–≤–æ–ª–æ–≤
mentions = re.findall(pattern, content)
```

**–°–æ–∑–¥–∞–Ω–∏–µ —É–ø–æ–º–∏–Ω–∞–Ω–∏–π:**
- –û–±—Ä–∞–±–æ—Ç–∫–∞ @all (—É–ø–æ–º–∏–Ω–∞–Ω–∏–µ –≤—Å–µ—Ö —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤ –∫—Ä–æ–º–µ –∞–≤—Ç–æ—Ä–∞)
- –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–≥–æ —É–ø–æ–º–∏–Ω–∞–Ω–∏—è –≤ –ë–î –ø–µ—Ä–µ–¥ –≤—Å—Ç–∞–≤–∫–æ–π
- –°–æ–∑–¥–∞–Ω–∏–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —É–ø–æ–º—è–Ω—É—Ç–æ–≥–æ
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ `set()` –¥–ª—è —É–Ω–∏–∫–∞–ª—å–Ω—ã—Ö user_id

### WebSocket –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è
```python
@sio.event
async def send_message(sid, data):
    new_message = message_repo.create(...)

    try:
        mention_repo.create_mentions(message_id, content, author_id, chat_id)
    except Exception as mention_error:
        print(f"Failed to create mentions: {mention_error}")
        # –°–æ–æ–±—â–µ–Ω–∏–µ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è –¥–∞–∂–µ –ø—Ä–∏ –æ—à–∏–±–∫–µ —É–ø–æ–º–∏–Ω–∞–Ω–∏–π
```

### API —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã
**–£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è:**
- `GET /notifications/` - —Å–ø–∏—Å–æ–∫ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ —Ç–æ–ª—å–∫–æ –Ω–µ–ø—Ä–æ—á–∏—Ç–∞–Ω–Ω—ã—Ö, –ª–∏–º–∏—Ç 50)
- `GET /notifications/unread-count` - —Å—á–µ—Ç—á–∏–∫ –¥–ª—è –±–µ–π–¥–∂–∞
- `POST /notifications/{id}/read` - –ø–æ–º–µ—Ç–∏—Ç—å –∫–∞–∫ –ø—Ä–æ—á–∏—Ç–∞–Ω–Ω–æ–µ
- `POST /notifications/mark-all-read` - –ø–æ–º–µ—Ç–∏—Ç—å –≤—Å–µ

**–°–æ–æ–±—â–µ–Ω–∏—è:**
- `GET /messages/message/{message_id}` - –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Å–æ–æ–±—â–µ–Ω–∏–∏ –¥–ª—è –Ω–∞–≤–∏–≥–∞—Ü–∏–∏

### –£–¥–∞–ª–µ–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏–π
**–ü–∞—Ä–∞–º–µ—Ç—Ä force:**
```python
def delete(self, message_id, user_id, force=False):
    if message.user_id == user_id or force:
        message.is_deleted = True
        # –£–¥–∞–ª–µ–Ω–∏–µ —Å–≤—è–∑–∞–Ω–Ω—ã—Ö —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
        self.db.query(Notification).filter(...).delete()
```

–ü–æ–∑–≤–æ–ª—è–µ—Ç –∞–¥–º–∏–Ω–∞–º/–º–æ–¥–µ—Ä–∞—Ç–æ—Ä–∞–º —É–¥–∞–ª—è—Ç—å —á—É–∂–∏–µ —Å–æ–æ–±—â–µ–Ω–∏—è

### Frontend - UI
**–ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã:**
- –ò–∫–æ–Ω–∫–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π —Å –±–µ–π–¥–∂–µ–º
- Dropdown –∞–≤—Ç–æ–¥–æ–ø–æ–ª–Ω–µ–Ω–∏—è —É–ø–æ–º–∏–Ω–∞–Ω–∏–π
- –ü–∞–Ω–µ–ª—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π (—Å–≤–µ—Ç–ª–∞—è —Ç–µ–º–∞)

**–°—Ç–∏–ª–∏:**
```css
.mention {
    background: rgba(114, 137, 218, 0.3);
    color: #7289da;  /* –ï–¥–∏–Ω—ã–π —Ü–≤–µ—Ç –¥–ª—è –≤—Å–µ—Ö —Ç–∏–ø–æ–≤ */
}

.notification-item.unread {
    background: #f8f9fa;
    border-left: 3px solid #8B0000;
}

.message.highlighted {
    animation: messageHighlight 2s ease;
}
```

**–°–æ–±—Å—Ç–≤–µ–Ω–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è:**
- –°–≤–µ—Ç–ª–æ-—Å–µ—Ä—ã–π `#d1d1d1` –≤–º–µ—Å—Ç–æ —Ñ–∏–æ–ª–µ—Ç–æ–≤–æ–≥–æ –≥—Ä–∞–¥–∏–µ–Ω—Ç–∞

### Frontend - –õ–æ–≥–∏–∫–∞
**–û–±—Ä–∞–±–æ—Ç–∫–∞ —É–ø–æ–º–∏–Ω–∞–Ω–∏–π:**
```javascript
function processMentions(text) {
    const escaped = escapeHtml(text);
    const mentionPattern = /@([^\s@]+)/g;
    return escaped.replace(mentionPattern, (match, nickname) => {
        return `<span class="mention" data-mention="${escapedNickname}">@${escapedNickname}</span>`;
    });
}
```

**–°—á–µ—Ç—á–∏–∫ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π:**
- –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–∞–∂–¥—ã–µ 30 —Å–µ–∫—É–Ω–¥ —á–µ—Ä–µ–∑ heartbeat
- –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ "99+" –¥–ª—è –±–æ–ª—å—à–∏—Ö —á–∏—Å–µ–ª

**–ù–∞–≤–∏–≥–∞—Ü–∏—è –∫ —Å–æ–æ–±—â–µ–Ω–∏—é:**
```javascript
async function navigateToMessage(messageId) {
    const messageInfo = await API.getMessageInfo(messageId);
    // –û—Ç–∫—Ä—ã—Ç–∏–µ –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–∞/—á–∞—Ç–∞
    await selectSpace(space) –∏–ª–∏ await selectChat(chat);
    // –û–∂–∏–¥–∞–Ω–∏–µ —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥–∞ 500ms
    // –°–∫—Ä–æ–ª–ª –∫ —Å–æ–æ–±—â–µ–Ω–∏—é + –ø–æ–¥—Å–≤–µ—Ç–∫–∞ –∞–Ω–∏–º–∞—Ü–∏–µ–π
}
```

**–ê–≤—Ç–æ–¥–æ–ø–æ–ª–Ω–µ–Ω–∏–µ:**
- –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ @ –≤ —Ç–µ–∫—Å—Ç–µ
- –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–æ–±–µ–ª–∞ –ø–µ—Ä–µ–¥ @
- –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤ –ø–æ –≤–≤–µ–¥–µ–Ω–Ω–æ–º—É —Ç–µ–∫—Å—Ç—É
- –î–æ–±–∞–≤–ª–µ–Ω–∏–µ @all –¥–ª—è –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤
- –ö–ª–∞–≤–∏–∞—Ç—É—Ä–Ω–∞—è –Ω–∞–≤–∏–≥–∞—Ü–∏—è (Enter/Escape)
- –°–±—Ä–æ—Å —Å–ø–∏—Å–∫–∞ —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤ –ø—Ä–∏ —Å–º–µ–Ω–µ –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–∞

### –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã
1. –î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ —É–ø–æ–º–∏–Ω–∞–Ω–∏–π - `set()` + –ø—Ä–æ–≤–µ—Ä–∫–∞ –≤ –ë–î + –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫
2. –£–ø–æ–º–∏–Ω–∞–Ω–∏—è –Ω–µ –ø–æ–¥—Å–≤–µ—á–∏–≤–∞–ª–∏—Å—å - –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ `processMentions()` –≤–º–µ—Å—Ç–æ `escapeHtml()`
3. –°–ø–µ—Ü–∏–∞–ª—å–Ω—ã–µ —Å–∏–º–≤–æ–ª—ã - –ø–∞—Ç—Ç–µ—Ä–Ω `@([^\s@]+)` –≤–º–µ—Å—Ç–æ `@(\w+)`
4. –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –Ω–µ –æ—Ç–æ–±—Ä–∞–∂–∞–ª–∏—Å—å - –æ–±—Ä–∞–±–æ—Ç–∫–∞ –º–∞—Å—Å–∏–≤–∞ –∏ –æ–±—ä–µ–∫—Ç–∞
5. –û—à–∏–±–∫–∞ "openSpace is not defined" - –∑–∞–º–µ–Ω–∞ –Ω–∞ `selectSpace()` –∏ `selectChat()`
6. –¢–µ–º–Ω–∞—è —Ç–µ–º–∞ - –∏–∑–º–µ–Ω–µ–Ω–∏–µ –Ω–∞ —Å–≤–µ—Ç–ª—É—é (#ffffff, #2c3e50)
7. –†–∞–∑–Ω—ã–µ —Ü–≤–µ—Ç–∞ —É–ø–æ–º–∏–Ω–∞–Ω–∏–π - –µ–¥–∏–Ω—ã–π —Ü–≤–µ—Ç #7289da
8. –§–∏–æ–ª–µ—Ç–æ–≤—ã–π –≥—Ä–∞–¥–∏–µ–Ω—Ç —Å–≤–æ–∏—Ö —Å–æ–æ–±—â–µ–Ω–∏–π - —Å–≤–µ—Ç–ª–æ-—Å–µ—Ä—ã–π #d1d1d1

---

## 2025-12-11 - –î–æ—Ä–∞–±–æ—Ç–∫–∞ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–π –∏ —Å–µ—Ç–µ–≤—ã—Ö —Å—Ç–∞—Ç—É—Å–æ–≤

### –°–∏—Å—Ç–µ–º–∞ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–π
- –î–µ—Ç–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è –¥–ª—è —Ä–æ–ª–µ–π (–æ—Ç–ø—Ä–∞–≤–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏–π, —Ñ–∞–π–ª–æ–≤, —É–¥–∞–ª–µ–Ω–∏–µ, —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —É—á–∞—Å—Ç–Ω–∏–∫–∞–º–∏)
- –ö–∞—Å—Ç–æ–º–Ω–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ –ø—Ä–∞–≤ –¥–ª—è –∫–∞–∂–¥–æ–π —Ä–æ–ª–∏
- –ü–µ—Ä–µ—Ä–∞–±–æ—Ç–∫–∞ –ª–æ–≥–∏–∫–∏ –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–π

### –°–µ—Ç–µ–≤—ã–µ —Å—Ç–∞—Ç—É—Å—ã
- –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (–æ–Ω–ª–∞–π–Ω/–æ—Ñ—Ñ–ª–∞–π–Ω/–æ—Ç–æ—à–µ–ª)
- –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –ø–æ—Å–ª–µ–¥–Ω–µ–π –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏
- –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å–æ —Å—Ö–µ–º–∞–º–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

**–ò–∑–º–µ–Ω–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã:** `models/permissions.py`, `schemas/user.py`, `routers/spaces.py`

---

## 2025-12-11 - –ê–≤–∞—Ç–∞—Ä—ã –¥–ª—è –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤/—á–∞—Ç–æ–≤

### –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–π —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª

- –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –∑–∞–≥—Ä—É–∑–∫–∏ –∞–≤–∞—Ç–∞—Ä–∞ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–∞
- –•—Ä–∞–Ω–µ–Ω–∏–µ –∞–≤–∞—Ç–∞—Ä–æ–≤ —á–µ—Ä–µ–∑ Cloudinary (–Ω–µ Supabase Storage)
- –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∞–≤–∞—Ç–∞—Ä–æ–≤ –≤ 3 –º–µ—Å—Ç–∞—Ö:
  - –õ–µ–≤–∞—è –ø–∞–Ω–µ–ª—å (—Å–ø–∏—Å–æ–∫ —á–∞—Ç–æ–≤) - –≤–º–µ—Å—Ç–æ —Ü–≤–µ—Ç–æ–≤–æ–≥–æ –≥—Ä–∞–¥–∏–µ–Ω—Ç–∞
  - –ó–∞–≥–æ–ª–æ–≤–æ–∫ —á–∞—Ç–∞ (–≤–µ—Ä—Ö–Ω—è—è —á–∞—Å—Ç—å –æ–∫–Ω–∞ —á–∞—Ç–∞)
  - –ü—Ä–∞–≤–∞—è –ø–∞–Ω–µ–ª—å (—Å–ø–∏—Å–æ–∫ —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤ –ø–æ —Ä–æ–ª—è–º)
- Fallback –Ω–∞ –≥—Ä–∞–¥–∏–µ–Ω—Ç + –ø–µ—Ä–≤–∞—è –±—É–∫–≤–∞ –ø—Ä–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–∏ –∞–≤–∞—Ç–∞—Ä–∞
- –í–∞–ª–∏–¥–∞—Ü–∏—è —Ñ–∞–π–ª–æ–≤ (—Ç–∏–ø: image/*, —Ä–∞–∑–º–µ—Ä: –¥–æ 10MB)
- –ü—Ä–µ–≤—å—é –∞–≤–∞—Ç–∞—Ä–∞ –≤ –º–æ–¥–∞–ª—å–Ω–æ–º –æ–∫–Ω–µ –ø–µ—Ä–µ–¥ –∑–∞–≥—Ä—É–∑–∫–æ–π

### Backend –∏–∑–º–µ–Ω–µ–Ω–∏—è

- –î–æ–±–∞–≤–ª–µ–Ω—ã –ø–æ–ª—è `avatar_url` –≤ –º–æ–¥–µ–ª–∏ `Space` –∏ `Chat` (models/base.py)
- –û–±–Ω–æ–≤–ª–µ–Ω—ã Pydantic —Å—Ö–µ–º—ã `SpaceCreate` –∏ `SpaceOut` (schemas/space.py)
- –û–±–Ω–æ–≤–ª–µ–Ω –º–µ—Ç–æ–¥ `create()` –≤ `SpaceRepository` –¥–ª—è –ø—Ä–∏–Ω—è—Ç–∏—è `avatar_url` (crud/space.py)
- –°–æ–∑–¥–∞–Ω endpoint `POST /spaces/{space_id}/upload-avatar` —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º `FileUploader.upload_image()` (routers/spaces.py)
- –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∞–≤ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞ –ø–µ—Ä–µ–¥ –∑–∞–≥—Ä—É–∑–∫–æ–π –∞–≤–∞—Ç–∞—Ä–∞

### Frontend –∏–∑–º–µ–Ω–µ–Ω–∏—è

- –î–æ–±–∞–≤–ª–µ–Ω file input —Å –ø—Ä–µ–≤—å—é –≤ –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —Å–æ–∑–¥–∞–Ω–∏—è –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–∞ (MIN/js/modal.js)
- –°–æ–∑–¥–∞–Ω –º–µ—Ç–æ–¥ `uploadSpaceAvatar()` –≤ API client (MIN/js/api.js)
- –û–±–Ω–æ–≤–ª–µ–Ω–∞ –ª–æ–≥–∏–∫–∞ —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥–∞ –≤ `renderSpaces()`, –∑–∞–≥–æ–ª–æ–≤–∫–µ —á–∞—Ç–∞ –∏ –ø—Ä–∞–≤–æ–π –ø–∞–Ω–µ–ª–∏ (MIN/js/chat.js)

### –û—Å–Ω–æ–≤–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã

**–ü—Ä–æ–±–ª–µ–º–∞ 1:** –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤ –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è

- **–ü—Ä–∏—á–∏–Ω–∞:** SQLAlchemy –Ω–µ —Å–æ–∑–¥–∞–µ—Ç –Ω–æ–≤—ã–µ –∫–æ–ª–æ–Ω–∫–∏ –≤ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö —Ç–∞–±–ª–∏—Ü–∞—Ö –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏

- **–†–µ—à–µ–Ω–∏–µ:** –†—É—á–Ω–æ–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ SQL –∫–æ–º–∞–Ω–¥:

```sql
ALTER TABLE spaces ADD COLUMN avatar_url VARCHAR(500);
ALTER TABLE chats ADD COLUMN avatar_url VARCHAR(500);
```

**–ü—Ä–æ–±–ª–µ–º–∞ 2:** "Failed to fetch" –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –∞–≤–∞—Ç–∞—Ä–∞, URL —Å–æ–¥–µ—Ä–∂–∞–ª "undefined"

- **–ü—Ä–∏—á–∏–Ω–∞:** –ú–µ—Ç–æ–¥ `uploadSpaceAvatar()` –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª `this.baseURL` –∏ `this.token`, –Ω–æ API - –æ–±—ä–µ–∫—Ç, –Ω–µ –∫–ª–∞—Å—Å

- **–†–µ—à–µ–Ω–∏–µ:** –ò–∑–º–µ–Ω–µ–Ω–æ –Ω–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –≥–ª–æ–±–∞–ª—å–Ω—ã—Ö —Ñ—É–Ω–∫—Ü–∏–π:

```javascript
const token = AuthService.getToken();
const url = `${CONFIG.API_BASE_URL}/spaces/${spaceId}/upload-avatar`;
```

**–ò–∑–º–µ–Ω–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã:** `models/base.py`, `schemas/space.py`, `crud/space.py`, `routers/spaces.py`, `MIN/js/modal.js`, `MIN/js/api.js`, `MIN/js/chat.js`
