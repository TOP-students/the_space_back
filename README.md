# The Space - Real-time Social Platform

**The Space** ‚Äî —ç—Ç–æ —Å–æ–≤—Ä–µ–º–µ–Ω–Ω–∞—è —Å–æ—Ü–∏–∞–ª—å–Ω–∞—è –ø–ª–∞—Ç—Ñ–æ—Ä–º–∞ –¥–ª—è –æ–±—â–µ–Ω–∏—è –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏, –ø–æ—Å—Ç—Ä–æ–µ–Ω–Ω–∞—è –Ω–∞ FastAPI –∏ Socket.IO. –ü—Ä–æ–µ–∫—Ç –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç —Å–æ–∑–¥–∞–Ω–∏–µ –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤ (spaces), –ø—Ä–∏–≤–∞—Ç–Ω—ã–µ –∏ –≥—Ä—É–ø–ø–æ–≤—ã–µ —á–∞—Ç—ã, —Å–∏—Å—Ç–µ–º—É —Ä–æ–ª–µ–π –∏ –ø—Ä–∞–≤ –¥–æ—Å—Ç—É–ø–∞.

## üåü –û—Å–Ω–æ–≤–Ω—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

- **Real-time –∫–æ–º–º—É–Ω–∏–∫–∞—Ü–∏—è** —á–µ—Ä–µ–∑ WebSocket (Socket.IO)
- **–ü—Ä–∏–≤–∞—Ç–Ω—ã–µ —á–∞—Ç—ã** –º–µ–∂–¥—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏
- **–ü—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–∞ (Spaces)** —Å –≥—Ä—É–ø–ø–æ–≤—ã–º–∏ —á–∞—Ç–∞–º–∏
- **–°–∏—Å—Ç–µ–º–∞ —Ä–æ–ª–µ–π** —Å –≥–∏–±–∫–∏–º–∏ –ø—Ä–∞–≤–∞–º–∏ –¥–æ—Å—Ç—É–ø–∞ (RBAC)
- **JWT –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è** —Å OAuth2 flow
- **Rate limiting** –¥–ª—è –∑–∞—â–∏—Ç—ã –æ—Ç –∑–ª–æ—É–ø–æ—Ç—Ä–µ–±–ª–µ–Ω–∏–π
- **–ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞** –¥–ª—è –≤—ã—Å–æ–∫–æ–π –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
- **–°—Ç–∞—Ç—É—Å—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π** (online/offline) –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏

## üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
the_space/
‚îú‚îÄ‚îÄ main.py                    # –¢–æ—á–∫–∞ –≤—Ö–æ–¥–∞, –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
‚îú‚îÄ‚îÄ requirements.txt           # –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –ø—Ä–æ–µ–∫—Ç–∞
‚îú‚îÄ‚îÄ test_client.html          # –¢–µ—Å—Ç–æ–≤—ã–π HTML –∫–ª–∏–µ–Ω—Ç –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ API
‚îÇ
‚îú‚îÄ‚îÄ models/                    # SQLAlchemy –º–æ–¥–µ–ª–∏ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
‚îÇ   ‚îú‚îÄ‚îÄ __init__.py           # –≠–∫—Å–ø–æ—Ä—Ç –≤—Å–µ—Ö –º–æ–¥–µ–ª–µ–π
‚îÇ   ‚îú‚îÄ‚îÄ base.py               # –ë–∞–∑–æ–≤—ã–π –∫–ª–∞—Å—Å –¥–ª—è –º–æ–¥–µ–ª–µ–π
‚îÇ   ‚îú‚îÄ‚îÄ user.py               # –ú–æ–¥–µ–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
‚îÇ   ‚îú‚îÄ‚îÄ chat.py               # –ú–æ–¥–µ–ª–∏ —á–∞—Ç–∞ –∏ —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤ (Chat, ChatParticipant)
‚îÇ   ‚îú‚îÄ‚îÄ message.py            # –ú–æ–¥–µ–ª–∏ —Å–æ–æ–±—â–µ–Ω–∏—è –∏ –≤–ª–æ–∂–µ–Ω–∏–π (Message, Attachment)
‚îÇ   ‚îú‚îÄ‚îÄ space.py              # –ú–æ–¥–µ–ª—å –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–∞
‚îÇ   ‚îú‚îÄ‚îÄ role.py               # –ú–æ–¥–µ–ª–∏ —Ä–æ–ª–µ–π (Role, UserRole)
‚îÇ   ‚îî‚îÄ‚îÄ ban.py                # –ú–æ–¥–µ–ª—å –±–∞–Ω–æ–≤
‚îÇ
‚îú‚îÄ‚îÄ schemas/                   # Pydantic —Å—Ö–µ–º—ã –¥–ª—è –≤–∞–ª–∏–¥–∞—Ü–∏–∏
‚îÇ   ‚îú‚îÄ‚îÄ __init__.py           # –≠–∫—Å–ø–æ—Ä—Ç –≤—Å–µ—Ö —Å—Ö–µ–º
‚îÇ   ‚îú‚îÄ‚îÄ auth.py               # –°—Ö–µ–º—ã –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ (Token)
‚îÇ   ‚îú‚îÄ‚îÄ user.py               # UserCreate, UserOut
‚îÇ   ‚îú‚îÄ‚îÄ chat.py               # PrivateChatCreate, ChatResponse
‚îÇ   ‚îú‚îÄ‚îÄ message.py            # MessageCreate, MessageOut
‚îÇ   ‚îú‚îÄ‚îÄ space.py              # SpaceCreate, SpaceOut
‚îÇ   ‚îú‚îÄ‚îÄ role.py               # RoleCreate, RoleOut
‚îÇ   ‚îî‚îÄ‚îÄ ban.py                # BanCreate
‚îÇ
‚îú‚îÄ‚îÄ routers/                   # API endpoints (FastAPI —Ä–æ—É—Ç–µ—Ä—ã)
‚îÇ   ‚îú‚îÄ‚îÄ __init__.py           # –≠–∫—Å–ø–æ—Ä—Ç —Ä–æ—É—Ç–µ—Ä–æ–≤
‚îÇ   ‚îú‚îÄ‚îÄ auth.py               # –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è, –ª–æ–≥–∏–Ω, –≤—ã—Ö–æ–¥
‚îÇ   ‚îú‚îÄ‚îÄ chats.py              # –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —á–∞—Ç–∞–º–∏ –∏ —Å–æ–æ–±—â–µ–Ω–∏—è–º–∏
‚îÇ   ‚îú‚îÄ‚îÄ spaces.py             # –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–∞–º–∏, —É—á–∞—Å—Ç–Ω–∏–∫–∞–º–∏, –±–∞–Ω–∞–º–∏
‚îÇ   ‚îî‚îÄ‚îÄ roles.py              # –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ä–æ–ª—è–º–∏ –∏ –ø—Ä–∞–≤–∞–º–∏
‚îÇ
‚îú‚îÄ‚îÄ utils/                     # –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ –º–æ–¥—É–ª–∏
‚îÇ   ‚îú‚îÄ‚îÄ __init__.py           # –≠–∫—Å–ø–æ—Ä—Ç —É—Ç–∏–ª–∏—Ç
‚îÇ   ‚îú‚îÄ‚îÄ database.py           # –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –ë–î, —Å–æ–∑–¥–∞–Ω–∏–µ —Å–µ—Å—Å–∏–π
‚îÇ   ‚îú‚îÄ‚îÄ security.py           # JWT —Ç–æ–∫–µ–Ω—ã, —Ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–∞—Ä–æ–ª–µ–π
‚îÇ   ‚îú‚îÄ‚îÄ dependencies.py       # FastAPI dependencies (get_current_user)
‚îÇ   ‚îî‚îÄ‚îÄ permissions.py        # –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∞–≤ –¥–æ—Å—Ç—É–ø–∞
‚îÇ
‚îî‚îÄ‚îÄ websockets/                # Socket.IO –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏
    ‚îú‚îÄ‚îÄ __init__.py           # –≠–∫—Å–ø–æ—Ä—Ç handlers
    ‚îî‚îÄ‚îÄ handlers.py           # –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–æ–±—ã—Ç–∏–π (connect, join_room, send_message)
```

## üõ† –¢–µ—Ö–Ω–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–π —Å—Ç–µ–∫

- **Backend:** FastAPI (Python 3.13+)
- **Database:** PostgreSQL + asyncpg
- **Real-time:** Socket.IO (python-socketio)
- **ORM:** SQLAlchemy 2.0 (async)
- **Authentication:** JWT (python-jose)
- **Password Hashing:** bcrypt (passlib)
- **Validation:** Pydantic v2
- **Rate Limiting:** slowapi
- **ASGI Server:** Uvicorn

## üöÄ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

### –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è

- Python 3.13+
- PostgreSQL 13+
- pip

### –£—Å—Ç–∞–Ω–æ–≤–∫–∞

1. –ö–ª–æ–Ω–∏—Ä—É–π—Ç–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π:
```bash
git clone https://github.com/your-username/the_space.git
cd the_space
```

2. –°–æ–∑–¥–∞–π—Ç–µ –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–µ –æ–∫—Ä—É–∂–µ–Ω–∏–µ:
```bash
python -m venv venv
source venv/bin/activate  # Linux/Mac
venv\Scripts\activate     # Windows
```

3. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏:
```bash
pip install -r requirements.txt
```

4. –ù–∞—Å—Ç—Ä–æ–π—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è (—Å–æ–∑–¥–∞–π—Ç–µ `.env`):
```env
SECRET_KEY=your-secret-key-here
DATABASE_URL=postgresql+asyncpg://user:password@localhost/chat_db
```

5. –°–æ–∑–¥–∞–π—Ç–µ –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö PostgreSQL:
```bash
createdb chat_db
```

6. –ó–∞–ø—É—Å—Ç–∏—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ:
```bash
python main.py
```

–°–µ—Ä–≤–µ—Ä –±—É–¥–µ—Ç –¥–æ—Å—Ç—É–ø–µ–Ω –ø–æ –∞–¥—Ä–µ—Å—É: http://localhost:8000

**API –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è:** http://localhost:8000/docs

**–¢–µ—Å—Ç–æ–≤—ã–π –∫–ª–∏–µ–Ω—Ç:** –æ—Ç–∫—Ä–æ–π—Ç–µ `test_client.html` –≤ –±—Ä–∞—É–∑–µ—Ä–µ

## üìö –ü–æ–¥—Ä–æ–±–Ω–∞—è –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è

–ü–æ–ª–Ω–∞—è –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ —É—Å—Ç–∞–Ω–æ–≤–∫–µ –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–µ –¥–æ—Å—Ç—É–ø–Ω–∞ –≤ [SETUP.md](SETUP.md)

## üèó –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

### REST API + WebSocket

–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –≥–∏–±—Ä–∏–¥–Ω—É—é –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—É:
- **REST API** (FastAPI) –¥–ª—è CRUD –æ–ø–µ—Ä–∞—Ü–∏–π
- **WebSocket** (Socket.IO) –¥–ª—è real-time –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π

### –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ—Å—Ç—å

–í—Å–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ —Å –ë–î –ø–æ–ª–Ω–æ—Å—Ç—å—é –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–µ:
- `AsyncSession` –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å PostgreSQL
- `asyncpg` –¥—Ä–∞–π–≤–µ—Ä –¥–ª—è –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–π –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
- `async/await` –≤–æ –≤—Å–µ—Ö handlers

### –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

- JWT —Ç–æ–∫–µ–Ω—ã —Å –∏—Å—Ç–µ—á–µ–Ω–∏–µ–º —Å—Ä–æ–∫–∞ –¥–µ–π—Å—Ç–≤–∏—è
- Bcrypt —Ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–∞—Ä–æ–ª–µ–π
- Rate limiting –Ω–∞ –∫—Ä–∏—Ç–∏—á–Ω—ã—Ö endpoints
- RBAC —Å–∏—Å—Ç–µ–º–∞ –ø—Ä–∞–≤ –¥–æ—Å—Ç—É–ø–∞
- –ü—Ä–æ–≤–µ—Ä–∫–∞ –±–∞–Ω–æ–≤ –ø—Ä–∏ –≤—Ö–æ–¥–µ –≤ –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–∞

## üìù API Endpoints

### Authentication
- `POST /register` - –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –Ω–æ–≤–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- `POST /token` - –í—Ö–æ–¥ (–ø–æ–ª—É—á–µ–Ω–∏–µ JWT —Ç–æ–∫–µ–Ω–∞)
- `POST /logout` - –í—ã—Ö–æ–¥ –∏–∑ —Å–∏—Å—Ç–µ–º—ã

### Chats
- `POST /chats` - –°–æ–∑–¥–∞—Ç—å –ø—Ä–∏–≤–∞—Ç–Ω—ã–π —á–∞—Ç
- `GET /chats/{chat_id}/messages` - –ü–æ–ª—É—á–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏—è
- `POST /chats/{chat_id}/messages` - –û—Ç–ø—Ä–∞–≤–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ

### Spaces
- `POST /spaces` - –°–æ–∑–¥–∞—Ç—å –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–æ
- `POST /spaces/{space_id}/join` - –ü—Ä–∏—Å–æ–µ–¥–∏–Ω–∏—Ç—å—Å—è –∫ –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤—É
- `GET /spaces/{space_id}/participants` - –°–ø–∏—Å–æ–∫ —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤
- `POST /spaces/{space_id}/kick/{user_id}` - –ò—Å–∫–ª—é—á–∏—Ç—å —É—á–∞—Å—Ç–Ω–∏–∫–∞
- `POST /spaces/{space_id}/ban/{user_id}` - –ó–∞–±–∞–Ω–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

### Roles
- `POST /spaces/{space_id}/roles` - –°–æ–∑–¥–∞—Ç—å —Ä–æ–ª—å
- `POST /spaces/{space_id}/assign-role/{user_id}/{role_id}` - –ù–∞–∑–Ω–∞—á–∏—Ç—å —Ä–æ–ª—å

### Socket.IO Events

**Client ‚Üí Server:**
- `connect` - –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ (—Å JWT —Ç–æ–∫–µ–Ω–æ–º)
- `join_room` - –ü—Ä–∏—Å–æ–µ–¥–∏–Ω–∏—Ç—å—Å—è –∫ —á–∞—Ç—É
- `leave_room` - –ü–æ–∫–∏–Ω—É—Ç—å —á–∞—Ç
- `send_message` - –û—Ç–ø—Ä–∞–≤–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ

**Server ‚Üí Client:**
- `user_status_changed` - –°—Ç–∞—Ç—É—Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏–∑–º–µ–Ω–∏–ª—Å—è
- `user_joined` - –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø—Ä–∏—Å–æ–µ–¥–∏–Ω–∏–ª—Å—è –∫ —á–∞—Ç—É
- `user_left` - –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–æ–∫–∏–Ω—É–ª —á–∞—Ç
- `new_message` - –ù–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –≤ —á–∞—Ç–µ

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

–û—Ç–∫—Ä–æ–π—Ç–µ `test_client.html` –≤ –±—Ä–∞—É–∑–µ—Ä–µ –ø–æ—Å–ª–µ –∑–∞–ø—É—Å–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞.

–¢–µ—Å—Ç–æ–≤—ã–π –∫–ª–∏–µ–Ω—Ç –ø–æ–∑–≤–æ–ª—è–µ—Ç:
- –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- –í–æ–π—Ç–∏ –≤ —Å–∏—Å—Ç–µ–º—É
- –°–æ–∑–¥–∞—Ç—å –ø—Ä–∏–≤–∞—Ç–Ω—ã–π —á–∞—Ç
- –û—Ç–ø—Ä–∞–≤–ª—è—Ç—å –∏ –ø–æ–ª—É—á–∞—Ç—å —Å–æ–æ–±—â–µ–Ω–∏—è –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏

## üë• –ê–≤—Ç–æ—Ä

–°–æ–∑–¥–∞–Ω–æ –≤ —Ä–∞–º–∫–∞—Ö —É—á–µ–±–Ω–æ–≥–æ –ø—Ä–æ–µ–∫—Ç–∞ TopAcademy
