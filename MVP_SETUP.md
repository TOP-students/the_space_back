# Инструкция по запуску MVP

## Требования

- Python 3.8+
- PostgreSQL (или Supabase)
- Браузер (Chrome, Firefox, Edge)

## Шаг 1: Настройка Backend

### 1.1 Установить зависимости

```bash
pip install -r requirements.txt
```

### 1.2 Настроить .env файл

Файл `.env` уже существует с подключением к БД. Проверь что DATABASE_URL правильный.

### 1.3 Запустить backend

```bash
python main.py
```

Backend запустится на `http://localhost:8000`

Проверь что работает: открой `http://localhost:8000/health` - должно вернуть `{"status":"ok"}`

## Шаг 2: Настройка Frontend

### 2.1 Запустить HTTP сервер для фронтенда

Открой **новое** окно терминала и выполни:

```bash
cd MIN
python -m http.server 3000
```

Frontend будет доступен на `http://localhost:3000`

## Шаг 3: Использование приложения

### 3.1 Регистрация

1. Открой в браузере: `http://localhost:3000/register.html`
2. Заполни форму:
   - Никнейм (любой уникальный)
   - Email (валидный формат)
   - Пароль (минимум 6 символов)
   - Подтверждение пароля
3. Нажми "Зарегистрироваться"
4. После успешной регистрации будет редирект на страницу входа

### 3.2 Вход

1. На странице `http://localhost:3000/login.html`
2. Введи email и пароль
3. Нажми "Войти"
4. После успеха попадешь на главный экран чата

### 3.3 Создание пространства (через API)

Пока нет UI для создания пространств. Создай их через API:

**Вариант 1: Через curl**

```bash
# Сначала получи токен (замени email и password на свои)
curl -X POST http://localhost:8000/auth/token \
  -H "Content-Type: application/x-www-form-urlencoded" \
  -d "username=test@example.com&password=123456"

# Скопируй access_token из ответа

# Создай пространство (замени YOUR_TOKEN на скопированный токен)
curl -X POST http://localhost:8000/spaces/ \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer YOUR_TOKEN" \
  -d '{"name": "Общий чат", "description": "Первое пространство для тестирования"}'
```

**Вариант 2: Через браузерную консоль**

1. Зайди на `http://localhost:3000/chat.html`
2. Открой DevTools (F12)
3. В консоли выполни:

```javascript
await API.createSpace("Общий чат", "Первое пространство");
await API.createSpace("Музыка", "Обсуждение музыки");
await API.createSpace("Игры", "Геймерский чат");
```

4. Обнови страницу (F5)

### 3.4 Общение в чате

1. В левом сайдбаре увидишь список пространств
2. Кликни на любое пространство
3. Увидишь историю сообщений (если есть)
4. Внизу будет поле ввода
5. Напиши сообщение и нажми "Отправить"
6. Сообщение появится в чате

### 3.5 Тестирование WebSocket (реальное время)

1. Открой чат в **двух разных вкладках** браузера (или в двух браузерах)
2. Зарегистрируй двух разных пользователей
3. Войди в один и тот же чат с обоих аккаунтов
4. Напиши сообщение в одной вкладке
5. Сообщение должно появиться во второй вкладке автоматически (через WebSocket)

## Возможные проблемы

### Ошибка CORS

Если видишь ошибку CORS в консоли браузера:
- Убедись что backend запущен на порту 8000
- Убедись что frontend запущен через `python -m http.server`, а не просто открыт файл

### Ошибка подключения к БД

Проверь:
- Правильный ли DATABASE_URL в `.env`
- Доступна ли БД (Supabase должен быть включен)

### WebSocket не работает

- Проверь в консоли браузера (F12) есть ли ошибки подключения Socket.IO
- Убедись что backend поддерживает Socket.IO (должно быть в requirements.txt: `python-socketio`)

## Что реализовано в MVP

✅ Регистрация и вход
✅ JWT аутентификация
✅ Список пространств
✅ Просмотр сообщений в пространстве
✅ Отправка сообщений
✅ Реальное время через WebSocket (Socket.IO)
✅ Автоматическое обновление сообщений

## Что НЕ реализовано

❌ Создание пространств через UI
❌ Редактирование/удаление сообщений
❌ Загрузка файлов
❌ Приватные чаты
❌ Управление участниками
❌ Роли и права
❌ Поиск по сообщениям через UI

## Структура проекта

```
MIN/
├── js/
│   ├── config.js          # Конфигурация (URL API)
│   ├── auth.js            # Управление токенами
│   ├── api.js             # HTTP клиент для API
│   ├── websocket.js       # WebSocket клиент (Socket.IO)
│   ├── login.js           # Логика входа/регистрации
│   └── chat.js            # Основная логика чата
├── css/
│   ├── style.css          # Общие стили
│   └── stylechat.css      # Стили чата
├── login.html             # Страница входа
├── register.html          # Страница регистрации
└── chat.html              # Главный экран чата
```
